<config xmlns="http://software.in2p3.fr/lavoisier/config.xsd" xmlns:date="http://exslt.org/dates-and-times" xmlns:str="http://exslt.org/strings" xmlns:xi="http://www.w3.org/2001/XInclude" version="15">




    <view name="OPSCORE_AR_SITES"><namespace prefix="date" uri="http://exslt.org/dates-and-times"/><namespace prefix="str" uri="http://exslt.org/strings"/>
        <info>
            <category>ARGO</category>
            <description>A/R for the last month for the sites</description>
        </info>


        <variable name="start_time" eval="concat(substring(date:add(date:date-time(),'-P30D'), 0,11),'T00:00:00Z')"/>
        <variable name="end_time" eval="concat(substring(date:add(date:date-time(),'-P1D'), 0,11),'T00:00:00Z')"/>


        <connector type="HTTPConnector">
            <parameter name="url" eval="concat(property('argo.sites.ar'),'&amp;start_time=',$start_time,'&amp;end_time=',$end_time)">
            </parameter>
        </connector>

        <processors>
            <element in="root">
                <attribute-create out="base_url">'http://argo.egi.eu/lavoisier/site_ar?granularity=daily&amp;report=Critical&amp;site='</attribute-create>

                <element-ignore in="group">
                    <element in="group" out="Site">
                        <attribute-create out="NGI">../ancestor::group/@name</attribute-create>
                        <attribute in="name" out="site"/>
                        <element in="results" out="Availability"/>
                    </element>
                </element-ignore>
            </element>

            <element in="root">
                <element-create-as-parent out="Profile">
                    <element in="Site"/>
                </element-create-as-parent>
            </element>

        </processors>

        <cache type="FileCache">
            <trigger type="DeltaTimeTrigger">
                <parameter name="hours">6</parameter>
            </trigger>
            <trigger type="ViewNotifiedTrigger"/>
            <trigger type="ViewCreatedTrigger"/>
        </cache>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">xml</parameter>
            </renderer>
        </renderers>

        </view>



</config>