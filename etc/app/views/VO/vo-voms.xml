<views xmlns="http://software.in2p3.fr/lavoisier/application.xsd" >


    <view name="voVoms">

        <connector type="XMLConnector">
            <parameter name="content" eval="view('vo-voms_INDEX')"/>
        </connector>

        <processors>

            <element in="data" out="voVoms">
                <element in="Vo">
                    <attribute-create out="name">../name/text()</attribute-create>
                    <attribute-ignore/>

                    <element in="VoVomsServer">
                        <element in="VoVomsServer">
                            <element-create as="last-child">view('voms-certificates')/results/X509Cert[@host=current()/../hostname/text()][1]</element-create>
                        </element>
                    </element>

                    <element-ignore/>
                </element>

            </element>

            <element in="voVoms">
                <element-ignore in="Vo" if="not(VoVomsServer/VoVomsServer/X509Cert)"/>
            </element>

        </processors>



        <cache type="FileCache">
            <trigger type="DeltaTimeTrigger">
                <parameter name="minutes">28</parameter>
            </trigger>
            <trigger type="ViewNotifiedTrigger"/>

        </cache>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>

    </view>




    <view name="vo-voms_INDEX">

        <connector type="XMLConnector">
            <parameter name="content" eval="view('VoListUrl')"/>
        </connector>

        <cache type="FileCache">
            <trigger type="DeltaTimeTrigger">
                <parameter name="minutes">30</parameter>
            </trigger>
            <trigger type="ViewNotifiedTrigger"/>
        </cache>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>
    </view>


    <view name="VoList" xmlns:e="http://software.in2p3.fr/lavoisier/entries.xsd">
        
        <connector type="XMLConnector">
            <parameter name="content" eval="view('VoEntries')"/>
        </connector>

        <processors>
            <element in="e:entries" out="data">
                <element in="e:entries" out="Vo" if="e:entry[@key='status']='Production'">
                    <attribute in="key" out="serial"/>
                    <attribute-create out="status">../e:entry[@key='status']/text()</attribute-create>
                    <attribute-create out="name">../e:entry[@key='name']/text()</attribute-create>
                   <attribute-create out="scope">../e:entry[@key='scope']/text()</attribute-create>
                    <attribute-create out="homeUrl">../e:entry[@key='homeUrl']/text()</attribute-create>
                    <attribute-create out="members">../e:entry[@key='members']/text()</attribute-create>

                    <element-ignore/>
                </element>
                <element-ignore/>
            </element>
            <element in="data" namespace-ignore="true" recursive="true"></element>


        </processors>

        <cache type="FileCache">
            <trigger type="DeltaTimeTrigger">
                <parameter name="minutes">12</parameter>
            </trigger>
            <trigger type="ViewNotifiedTrigger"/>
        </cache>
        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>

    </view>

    <view name="urls_checker_all">
        

        <argument name="vo"/>

        <connector type="XMLConnector">
            <parameter name="content" eval="view('urls_checker_raw')"/>
        </connector>

        <processors>
            <element in="data" out="root">
                <element-ignore in="Vo">
                    <element/>
                </element-ignore>

            </element>
        </processors>

        <cache type="FileCache">
            <trigger type="DeltaTimeTrigger">
                <parameter name="hours">8</parameter>
            </trigger>
            <trigger type="ViewNotifiedTrigger"/>
        </cache>
        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>


    </view>

    <view name="urls_checker">

        <argument name="vo"/>

    <connector type="XMLConnector">
        <parameter name="content" eval="view('urls_checker_raw')/data/Vo[@name=$vo]/*"/>
    </connector>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>

    </view>

    <view name="vo-urlsCheck_AGGR">
        

        <argument name="vo" path-format="none"/>


        <connector type="XMLConnector">
            <parameter name="content" eval="view('urls_checker_raw')/data/Vo[@name=$vo]/*"/>
        </connector>
        <processors>
                <element-create-as-parent out="voname" attributes="new_attribute('name',$vo)">
                    <element in="CheckVoUrls"/>
                </element-create-as-parent>

                 <element-create-as-parent out="root">
                     <element in="voname"/>
                 </element-create-as-parent>
        </processors>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>

    </view>


    <view name="urls_checker_raw">
        
        <connector type="XMLConnector">
            <parameter name="content" eval="view('VoList')"/>
        </connector>

        <processors>
            <element in="data">
                <element in="Vo">
                    <element-create>view('checkUrlsVo',entry('vo',../@name))</element-create>
                </element>
            </element>


        </processors>
        <cache type="FileCache">
            <trigger type="DeltaTimeTrigger">
                <parameter name="hours">9</parameter>
            </trigger>
            <trigger type="ViewNotifiedTrigger"/>
        </cache>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>
    </view>

    <view name="checkUrlsVo">
        
        <argument name="vo"/>
        <connector type="HTTPConnector">
            <parameter name="url" eval="concat(property('vo.check.url'),$vo)"/>
            <parameter name="header">
                <entry key="x-api-key" eval="property('lavoisier-token')"/>
                <entry key="Accept">application/xml</entry>
            </parameter>
            <parameter name="force-redirect">true</parameter>


                <fallback>
                    <exception type="java.io.IOException"/>
                    <exception type="org.xml.sax.SAXException"/>
                    <exception type="java.net.NoRouteToHostException"/>
                    <exception type="java.io.FileNotFoundException"/>
                    <exception type="java.lang.Exception"/>
                    <exception type="java.net.SocketTimeoutException"/>
                    <exception type="java.net.UnknownHostException"/>
                    <exception type="java.net.SocketException"/>
                    <exception type="java.lang.NullPointerException"/>
                </fallback>

        </connector>

    </view>

    <view xmlns:t="http://software.in2p3.fr/lavoisier/tables.xsd" name="osg_voms">
        
        <connector type="HTTPConnector">
            <parameter name="url">https://raw.githubusercontent.com/opensciencegrid/osg-vo-config/master/vomses</parameter>
        </connector>

        <serializer type="CSVSerializer">
            <parameter name="separators">
                <entry eval="' '"/>
            </parameter>
            <parameter name="strict">false</parameter>
        </serializer>


        <processors>
            <element in="t:tables" out="root">
                <element-ignore in="t:table">
                    <element in="t:row" out="item">
                        <attribute-create out="VO">../t:column[@label='1']/text()</attribute-create>
                        <attribute-create out="HOSTNAME">../t:column[@label='2']/text()</attribute-create>
                        <attribute-create out="VOMSPORT">../t:column[@label='3']/text()</attribute-create>
                        <attribute-create out="VOMSDN">../t:column[@label='4']/text()</attribute-create>
                        <attribute-create out="VOBIS">../t:column[@label='5']/text()</attribute-create>
                        <element-ignore/>
                    </element>                    
                </element-ignore>
                
            </element>
            
        </processors>
        <cache type="FileCache">
            <trigger type="DeltaTimeTrigger">
                <parameter name="hours">4</parameter>
            </trigger>
            <trigger type="ViewNotifiedTrigger"/>

        </cache>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>

    </view>

    <view xmlns:str="http://exslt.org/strings" name="voms-endpoint">
        

        <connector type="HTTPConnector">
            <parameter name="url" eval="property('voms.goc.url')"/>
            <parameter name="certificate" eval="property('certificate.path')"/>
            <parameter name="passphrase" eval="property('certificate.password')"/>
            <parameter name="force-redirect">true</parameter>
        </connector>

        <processors>
            <element in="results">
                <set variable="osg_voms">view("osg_voms")</set>
                <element-create as="first-child">$osg_voms</element-create>
            </element>

            <element in="results">
                <element-ignore in="root">
                    <element in="item" out="SERVICE_ENDPOINT">
                        <attribute-ignore/>
                        <attribute-create out="PRIMARY_KEY">concat(str:replace(../@HOSTNAME,'.','_'),'_',str:replace(../@VO,'.','_'))</attribute-create>

                        <element-create>new_element('PRIMARY_KEY',concat(str:replace(../@HOSTNAME,'.','_'),'_',str:replace(../@VO,'.','_')))</element-create>
                        <element-create>new_element('GOCDB_PORTAL_URL','http://myosg.grid.iu.edu/vovomsstatus?all_vos=on&amp;active=on&amp;active_value=1&amp;datasource=vomsstatus')</element-create>
                        <element-create>new_element('HOSTNAME',new_text(../@HOSTNAME))</element-create>
                        <element-create>new_element('HOSTDN',new_text(../@VOMSDN))</element-create>
                        <element-create>new_element('SERVICE_TYPE','VOMS')</element-create>
                        <element-create>new_element('IN_PRODUCTION','Y')</element-create>
                        <element-create>new_element('MONITORED','Y')</element-create>
                        <element-create>new_element('NODE_MONITORED','Y')</element-create>
                        <element-create>new_element('SITENAME','OSG')</element-create>
                        <element-create>new_element('COUNTRY_NAME','OSG')</element-create>
                        <element-create>new_element('COUNTRY_CODE','OSG')</element-create>
                        <element-create>new_element('ROC_NAME','OSG')</element-create>


                    </element>

                </element-ignore>
            </element>

            <element in="results">
                <element-create as="first-child">view("voms_fnal_hook")/SERVICES/*</element-create>
            </element>
        </processors>
        <cache type="FileCache">
            <trigger type="DeltaTimeTrigger">
                <parameter name="hours">3</parameter>
            </trigger>
            <trigger type="ViewNotifiedTrigger"/>

        </cache>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>
    </view>

    <view name="voms_fnal_hook">
        

        <connector type="XMLConnector">
            <parameter name="content">
                
                &lt;SERVICES&gt;&lt;SERVICE_ENDPOINT PRIMARY_KEY="voms_fnal_gov_hook"&gt;
                    &lt;PRIMARY_KEY&gt;voms_fnal_gov_hook&lt;/PRIMARY_KEY&gt;
                    &lt;GOCDB_PORTAL_URL&gt;&lt;/GOCDB_PORTAL_URL&gt;
                    &lt;HOSTNAME&gt;voms.fnal.gov&lt;/HOSTNAME&gt;
                    &lt;HOSTDN&gt;/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=voms.fnal.gov&lt;/HOSTDN&gt;
                    &lt;SERVICE_TYPE&gt;VOMS&lt;/SERVICE_TYPE&gt;
                    &lt;IN_PRODUCTION&gt;Y&lt;/IN_PRODUCTION&gt;
                    &lt;MONITORED&gt;Y&lt;/MONITORED&gt;
                    &lt;NODE_MONITORED&gt;Y&lt;/NODE_MONITORED&gt;
                    &lt;SITENAME&gt;OSG&lt;/SITENAME&gt;
                    &lt;COUNTRY_NAME&gt;OSG&lt;/COUNTRY_NAME&gt;
                    &lt;COUNTRY_CODE&gt;OSG&lt;/COUNTRY_CODE&gt;
                    &lt;ROC_NAME&gt;OSG&lt;/ROC_NAME&gt;
                &lt;/SERVICE_ENDPOINT&gt;
                 &lt;SERVICE_ENDPOINT PRIMARY_KEY="voms_fnal_gov_hook_2"&gt;
                    &lt;PRIMARY_KEY&gt;voms_fnal_gov_hook_2&lt;/PRIMARY_KEY&gt;
                    &lt;GOCDB_PORTAL_URL&gt;&lt;/GOCDB_PORTAL_URL&gt;
                    &lt;HOSTNAME&gt;voms1.fnal.gov&lt;/HOSTNAME&gt;
                    &lt;HOSTDN&gt;/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=voms.fnal.gov&lt;/HOSTDN&gt;
                    &lt;SERVICE_TYPE&gt;VOMS&lt;/SERVICE_TYPE&gt;
                    &lt;IN_PRODUCTION&gt;Y&lt;/IN_PRODUCTION&gt;
                    &lt;MONITORED&gt;Y&lt;/MONITORED&gt;
                    &lt;NODE_MONITORED&gt;Y&lt;/NODE_MONITORED&gt;
                    &lt;SITENAME&gt;OSG&lt;/SITENAME&gt;
                    &lt;COUNTRY_NAME&gt;OSG&lt;/COUNTRY_NAME&gt;
                    &lt;COUNTRY_CODE&gt;OSG&lt;/COUNTRY_CODE&gt;
                    &lt;ROC_NAME&gt;OSG&lt;/ROC_NAME&gt;
                &lt;/SERVICE_ENDPOINT&gt;
                 &lt;SERVICE_ENDPOINT PRIMARY_KEY="voms_fnal_gov_hook_3"&gt;
                    &lt;PRIMARY_KEY&gt;voms_fnal_gov_hook_3&lt;/PRIMARY_KEY&gt;
                    &lt;GOCDB_PORTAL_URL&gt;&lt;/GOCDB_PORTAL_URL&gt;
                    &lt;HOSTNAME&gt;voms2.fnal.gov&lt;/HOSTNAME&gt;
                    &lt;HOSTDN&gt;/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=voms.fnal.gov&lt;/HOSTDN&gt;
                    &lt;SERVICE_TYPE&gt;VOMS&lt;/SERVICE_TYPE&gt;
                    &lt;IN_PRODUCTION&gt;Y&lt;/IN_PRODUCTION&gt;
                    &lt;MONITORED&gt;Y&lt;/MONITORED&gt;
                    &lt;NODE_MONITORED&gt;Y&lt;/NODE_MONITORED&gt;
                    &lt;SITENAME&gt;OSG&lt;/SITENAME&gt;
                    &lt;COUNTRY_NAME&gt;OSG&lt;/COUNTRY_NAME&gt;
                    &lt;COUNTRY_CODE&gt;OSG&lt;/COUNTRY_CODE&gt;
                    &lt;ROC_NAME&gt;OSG&lt;/ROC_NAME&gt;
                &lt;/SERVICE_ENDPOINT&gt;&lt;/SERVICES&gt;
                
            </parameter>
        </connector>


    </view>


    <view name="voms-certificate-url" timeout="PT1M">
        
        <argument name="key"/>
        <argument name="url" eval="concat('https://',$key,':8443')"/>
        <connector type="PublicKeyConnector">
            <parameter name="url" eval="$url"/>
            <fallback eval="view('voms-certificate-url-fallback', entry('key',$key))">
                <exception type="fr.in2p3.lavoisier.interfaces.error.ConfigurationException"/>
                <exception type="java.net.SocketTimeoutException"/>
            </fallback>
        </connector>
        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>
    </view>

    <view name="voms-certificate-url-fallback" timeout="PT1M">

        <argument name="key"/>
        <argument name="url" eval="concat('https://',$key,':443')"/>
        <connector type="PublicKeyConnector">
            <parameter name="url" eval="$url"/>
            <fallback eval="view('cert_fallback', arguments())">
                <exception type="fr.in2p3.lavoisier.interfaces.error.ConfigurationException"/>
            </fallback>
        </connector>
        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>
    </view>





        <!-- echo "/bin/openssl s_client -connect \$1 2>/dev/null | /bin/openssl x509 \$2 \$3 \$4" > download-cert.sh -->
        <view name="cert_fallback" xmlns:e="http://software.in2p3.fr/lavoisier/entries.xsd">
            <argument name="url"/>
            <connector type="ShellConnector">
                <parameter name="executable">/usr/bin/sh</parameter>
                <parameter name="arguments">
                    <entry>/app/resources/shell/download-cert.sh</entry>
                    <entry eval="substring-after($url,'https://')"/>
                    <entry>-subject</entry>
                    <entry>-issuer</entry>
                    <entry>-noout</entry>
                    <entry>-enddate</entry>
                </parameter>
                <parameter name="workdir" eval="property('user.dir')"/>
                <fallback>
                    <exception type="java.lang.Exception"/>
                    <exception type="java.io.IOException"/>
                    <exception type="fr.in2p3.lavoisier.interfaces.error.AdaptorException"/>
                </fallback>
            </connector>

            <serializer type="PropertiesSerializer"/>
            <processors>
                <element out="X509Cert" in="e:entries">
                    <attribute-create out="expiry">../e:entry[@key='notAfter']/text()</attribute-create>
                    <attribute-create out="host">substring-before(substring-after($url,'https://'),':8443')</attribute-create>
                    <element out="DN" in="e:entry" if="@key='subject'">
                        <attribute-ignore/>
                    </element>
                    <element out="CA_DN" in="e:entry" if="@key='issuer'">
                        <attribute-ignore/>
                    </element>
                    <element-ignore in="e:entry" if="@key='notAfter'"/>
                    <element-create>view('cert_x509',arguments())/X509Cert/X509PublicKey</element-create>
                </element>
            </processors>
        </view>


        <view name="cert_x509" xmlns:e="http://software.in2p3.fr/lavoisier/entries.xsd">
            <argument name="url"/>
            <connector type="ShellConnector">
                <parameter name="executable">/usr/bin/sh</parameter>
                <parameter name="arguments">
                    <entry>/app/resources/shell/download-cert.sh</entry>
                    <entry eval="substring-after($url,'https://')"/>
                </parameter>
                <parameter name="workdir" eval="property('user.dir')"/>
            </connector>
            <serializer type="EncapsulateSerializer"/>
            <processors>
                <element in="e:entries" out="X509Cert">
                    <element in="e:entry" out="X509PublicKey"/>
                </element>
            </processors>
        </view>


    <view name="vomscert">
        <argument name="key"/>
        <connector type="XMLConnector">
            <parameter name="content" eval="view('voms-certificate-url',entry('key',$key))/*"/>
            <fallback>
                <exception type="java.lang.Exception"/>
                <exception type="java.net.SocketTimeoutException"/>
                <exception type="fr.in2p3.lavoisier.interfaces.error.AdaptorException"/>
            </fallback>
        </connector>
    </view>

    <view name="voms-certificates" xmlns:e="http://software.in2p3.fr/lavoisier/entries.xsd">
        

        <connector type="XMLConnector">
            <parameter name="content" eval="view('voms-endpoint')"/>
        </connector>


        <processors>
            <element in="results">
                <element-ignore in="SERVICE_ENDPOINT" if="HOSTNAME/text()=preceding-sibling::SERVICE_ENDPOINT/HOSTNAME/text()"/>
            </element>

            <element in="results">
                <element-ignore in="SERVICE_ENDPOINT">
                    <element-create>view('vomscert',entry('key',../HOSTNAME/text()))</element-create>
                </element-ignore>
            </element>

            <element in="results">
                <element-ignore in="e:entries"/>
            </element>

            <element in="results">
                <element-ignore in="X509Cert" if="@host=preceding-sibling::X509Cert/@host"/>
            </element>

        </processors>

        <cache type="FileCache">
            <trigger type="DeltaTimeTrigger">
                <parameter name="hours">8</parameter>
            </trigger>
            <trigger type="ViewNotifiedTrigger"/>
        </cache>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>

    </view>



    <view name="vo_users_history">
        
        <connector type="HTTPConnector">
            <parameter name="url" eval="property('vo.users.history')"/>
            <parameter name="header">
                <entry key="x-api-key" eval="property('lavoisier-token')"/>
                <entry key="Accept">application/xml</entry>
            </parameter>
            <parameter name="force-redirect">true</parameter>
        </connector>


        <cache type="FileCache">
            <trigger type="DeltaTimeTrigger">
                <parameter name="hours">10</parameter>
            </trigger>
            <trigger type="ViewNotifiedTrigger"/>
        </cache>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>

    </view>

    <view name="voIdcard">

        <argument name="vo">_VO_</argument>
        <connector type="XMLConnector">
            <parameter name="content" eval="view('VO_full_new')"/>
        </connector>

        <processors>
            <element in="data" out="root">
                <attribute-create out="current">'v3'</attribute-create>
                <element in="Vo" out="IDCard"/>
            </element>

            <element in="root" if="$vo!='_VO_'">
                <element-ignore in="IDCard" if="@key!=$vo"/>
            </element>
        </processors>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>

    </view>




    <view name="vo-idcard">


            <connector type="XSLTConnector">
                <parameter name="stylesheet" eval="document('/app/resources/xsl/vo-idcard.xsl')"/>
                <parameter name="input" eval="view('VO_full_new')"/>
                <parameter name="documents">
                    <entry key="voms-certificates" eval="view('voms-certificates')"/>
                    <entry key="cic_dump" eval="view('cic_dump')"/>
                    <entry key="VoDisciplinesList" eval="view('VoDisciplinesList')"/>
                </parameter>
            </connector>



        <cache type="FileCache">
            <trigger type="DeltaTimeTrigger">
                <parameter name="hours">6</parameter>
            </trigger>
            <trigger type="ViewNotifiedTrigger"/>
            <trigger type="DependencyRefreshedTrigger">
                <parameter name="views">
                    <entry>VO_full_new</entry>
                </parameter>
            </trigger>
        </cache>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>

    </view>




    <view name="vo-idcard-full">


        <connector type="XSLTConnector">
            <parameter name="stylesheet" eval="document('/app/resources/xsl/vo-idcard.xsl')"/>
            <parameter name="input" eval="view('VO_full_full')"/>
            <parameter name="documents">
                <entry key="voms-certificates" eval="view('voms-certificates')"/>
                <entry key="cic_dump" eval="view('cic_dump')"/>
                <entry key="VoDisciplinesList" eval="view('VoDisciplinesList')"/>
            </parameter>
        </connector>

        <cache type="FileCache">
            <trigger type="DeltaTimeTrigger">
                <parameter name="hours">10</parameter>
            </trigger>
            <trigger type="ViewNotifiedTrigger"/>
            <trigger type="DependencyRefreshedTrigger">
                <parameter name="views">
                    <entry>VO_full_full</entry>
                </parameter>
            </trigger>
        </cache>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>

    </view>

    <view name="vo-idcard-vo">

        <argument name="vo">_VO_</argument>
        <connector type="XMLConnector">
            <parameter name="content" eval="view('vo-idcard-full')"/>
        </connector>

        <processors>
            <element in="root">
                <element in="IDCard" if="@Name=$vo or $vo='_VO_'"/>
                <element-ignore/>
            </element>
        </processors>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>

    </view>

    <view name="vo-voms_listMembers" authenticators="local">

        

        <connector type="XMLConnector">
            <parameter name="content" eval="view('vo-voms_INDEX')"/>
        </connector>

        <processors>
            <element in="data">
                <element in="Vo">
                    <element-create>view('voms-members',entry('vo',../name/text()))</element-create>
                    <element-ignore/>
                </element>
                <element-create>view('perun-members-voms')/root/*</element-create>
            </element>

        </processors>

        <cache type="FileCache">
            <trigger type="FixedTimeTrigger">
                <parameter name="hour">4</parameter>
                <parameter name="minute">12</parameter>
            </trigger>
            <trigger type="FixedTimeTrigger">
                <parameter name="hour">14</parameter>
                <parameter name="minute">21</parameter>
            </trigger>
            <trigger type="ViewNotifiedTrigger"/>
        </cache>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>
    </view>

    <view name="voms-members">
        
        <argument name="vo">_VO_</argument>


        <connector type="HTTPConnector">
            <parameter name="url" eval="concat(property('voms.users'),$vo)"/>
            <parameter name="force-redirect">true</parameter>
            <parameter name="connect-timeout">140</parameter>
            <parameter name="header">
                <entry key="x-api-key" eval="property('lavoisier-token')"/>
                <entry key="Accept">application/xml</entry>
            </parameter>
            <fallback>
                <exception type="java.lang.Exception"/>
            </fallback>
        </connector>



        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>
    </view>

    <view name="perun-members">
        

        <connector type="FileConnector">
           <parameter name="path" eval="concat(property('lavoisier.cache.directory'),'/perunfile')"/>

            <fallback>
                <exception type="java.lang.Exception"/>
            </fallback>
        </connector>

        <serializer type="CSVSerializer">
            <parameter name="header">true</parameter>
        </serializer>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>
    </view>

    <view xmlns:t="http://software.in2p3.fr/lavoisier/tables.xsd" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" name="perun-members-voms">
        

        <connector type="XMLConnector">
            <parameter name="content" eval="view('perun-members')"/>
        </connector>

        <processors>

            <element in="t:tables" out="root">
                    <element-ignore>
                            <element in="t:row" out="multiRef">
                                <element in="t:column" if="count(preceding-sibling::t:column)=0" out="firstName"/>
                                <element in="t:column" if="count(preceding-sibling::t:column)=1" out="lastName"/>
                                <element in="t:column" if="count(preceding-sibling::t:column)=2" out="DN"/>
                                <element in="t:column" if="count(preceding-sibling::t:column)=3" out="vo"/>
                                <element in="t:column" if="count(preceding-sibling::t:column)=4" out="mail"/>
                                <element-create>new_element('CA','perun')</element-create>
                                <element-ignore/>
                            </element>
                    </element-ignore>
            </element>

            <element in="root">
                <element in="multiRef">
                    <element-create>new_element('CN',concat(../firstName/text(),' ',../lastName/text()))</element-create>
                    <element if="name()='DN' or name()='vo' or name()='CA' or name()='mail' "><attribute-ignore/></element>
                    <element-ignore/>
                </element>
            </element>
            
            <element in="root">
                <element-ignore/>                
                <element-create>sort_by_string(../multiRef,'vo/text()')</element-create>                
            </element>
            
            <element in="root">
                <element-create-as-parent out="VoListMembers" group-by="vo" attributes="new_attribute('VoName',vo/text())">
                    <element in="multiRef"/>
                </element-create-as-parent>
            </element>

            <element in="root">
                <element-create-as-parent out="Vo">
                    <element in="VoListMembers">
                            <element-create-as-parent out="soapenv:Body">
                                <element in="multiRef"/>
                            </element-create-as-parent>
                    </element>
                </element-create-as-parent>
            </element>

            <elements path="root/Vo/VoListMembers">
                <element-create-as-parent out="soapenv:Envelope">
                        <element in="soapenv:Body"/>
                </element-create-as-parent>
            </elements>

            <elements path="root/Vo/VoListMembers">
                    <element-create-as-parent out="VomsListMembers">
                        <element in="soapenv:Envelope"/>
                    </element-create-as-parent>
            </elements>
        </processors>



        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>
    </view>

    <view name="insert-voms-members">

        

        <connector type="XMLConnector">
            <parameter name="content" eval="view('vo-voms_INDEX')"/>
        </connector>

        <processors>
            <element in="data">
                <element in="Vo">
                    <element-create>view('insert-voms-members-vo',entry('vo',../name/text()))</element-create>
                    <element-ignore/>
                </element>

            </element>

        </processors>

        <cache type="FileCache">
            <trigger type="DeltaTimeTrigger">
                <parameter name="hours">6</parameter>
            </trigger>
            <trigger type="ViewNotifiedTrigger"/>
        </cache>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>
    </view>

    <view name="insert-voms-members-vo">
        
        <argument name="vo">_VO_</argument>
        <connector type="HTTPConnector">
            <parameter name="url" eval="concat(property('voms.users.db'),$vo)"/>


            <parameter name="header">
                <entry key="x-api-key" eval="property('lavoisier-token')"/>
                <entry key="Accept">application/xml</entry>
            </parameter>

            <parameter name="force-redirect">true</parameter>

            <fallback>
                <exception type="java.lang.Exception"/>
            </fallback>
        </connector>
        <processors>
            <element in="InsertVoUsers">
                <attribute-create out="Url">concat(property('voms.users.db'),$vo)</attribute-create>
            </element>
        </processors>
        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>
    </view>

    <view xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" name="vo-voms_listMembers-vo">
        
        <argument name="vo">_VO_</argument>
        <connector type="XMLConnector">
            <parameter name="content" eval="view('vo-voms_listMembers')"/>
        </connector>

        <processors>
            <element in="data" out="soapenv:ListMembers"/>
            <element in="soapenv:ListMembers" out="xsi:ListMembers"/>


            <element in="xsi:ListMembers" out="ListMembers">
                <element-create as="first-child">new_element('Id',new_text(../Vo/VoListMembers/VomsListMembers/@url))</element-create>
                <element-ignore in="Vo">
                    <element in="VoListMembers" if="@VoName=$vo" out="rows">

                        <elements-ignore path="/VomsListMembers/soapenv:Envelope/soapenv:Body">
                            <element in="multiRef" out="row" attributes="@id">
                                <element-create>new_element('VO',new_text($vo))</element-create>
                                <element-create>new_element('CA',new_text(../CA/text()))</element-create>
                                <element-create>new_element('DN',new_text(../DN/text()))</element-create>
                                <element-create>new_element('CN',new_text(choose(../CN/text(),../CN/text(),substring-after(../DN/text(),'CN='))))</element-create>
                                <element-create>new_element('mail',new_text(../mail/text()))</element-create>

                                <element-create>new_element('VOMS',new_text(../ancestor::VomsListMembers/@url))</element-create>
                                <element-ignore/>
                            </element>
                            <element-ignore/>
                        </elements-ignore>
                        <element-ignore/>
                    </element>
                </element-ignore>
            </element>


        </processors>
        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>
    </view>


    <view name="cic_dump">
        
        <connector type="FileConnector">
            <parameter name="path">/app/resources/xml/cic_voidcards_dump.xml</parameter>
        </connector>

        <processors>
            <element in="VOs"><element in="VO">
                <element-ignore/>
            </element></element>
        </processors>

        <cache type="FileCache">
            <trigger type="ViewCreatedTrigger"/>
            <trigger type="ViewNotifiedTrigger"/>
        </cache>
        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>
    </view>


    <view name="VoDisciplinesList" xmlns:e="http://software.in2p3.fr/lavoisier/entries.xsd">
        
        <connector type="XMLConnector">
            <parameter name="content" eval="view('VoEntries')"/>
        </connector>

        <processors>

            <element in="e:entries" out="rootD">

                <element in="e:entries" out="vo_Disciplines">
                    <attribute-create out="name">../e:entry[@key='name']/text()</attribute-create>
                    <element in="e:entries" if="@key='disciplines'" out="vo_Disciplines">
                        <element in="e:entries" out="level1">
                            <element in="e:entries" out="level2">
                                <element in="e:entry" out="level3"/>
                            </element>
                        </element>
                    </element>
                    <element-ignore/>
                    
                </element>

            </element>

        </processors>
        <cache type="FileCache">

            <trigger type="ViewNotifiedTrigger"/>

            <trigger type="DeltaTimeTrigger">
                <parameter name="minutes">43</parameter>
            </trigger>

            <trigger type="DependencyRefreshedTrigger">
                <parameter name="views">
                    <entry>VoDisciplinesAll</entry>
                </parameter>
            </trigger>
        </cache>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>
    </view>
    
    
    <view name="vomses-vo">
        <connector type="XMLConnector">
            <parameter name="content" eval="view('voms_vo')"/>
        </connector>

        <processors>
            <element in="data" out="VOS">

                <element in="Vo" out="VO">
                    <attribute-create out="key">../name/text()</attribute-create>
                    <element-ignore in="VoVomsServer">
                        <element in="VoVomsServer">
                            <attribute-create out="memberslisturl">../memberslisturl/text()</attribute-create>
                            <attribute-create out="hostname">../hostname/text()</attribute-create>
                            <element-ignore/>
                        </element>
                    </element-ignore>


                </element>
            </element>

        </processors>
    </view>

</views>